{% extends "base.html" %}

{% block title %}Gestionar Tareas - Task Manager{% endblock %}

{% block extra_css %}
<style>
    .create-task-form {
        background: #f5f5f7;
        padding: 2rem;
        border-radius: 10px;
        margin-bottom: 2rem;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 2fr 3fr 1fr;
        gap: 1rem;
        align-items: end;
    }
    
    .form-group {
        margin-bottom: 0;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
    
    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #d1d1d6;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
    }
    
    .tasks-list {
        list-style: none;
    }
    
    .task-list-item {
        background: white;
        border: 1px solid #e5e5e7;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .task-info h4 {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
    }
    
    .task-info p {
        color: #86868b;
        margin-bottom: 0.5rem;
    }
    
    .task-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .task-inactive {
        opacity: 0.6;
        background: #f5f5f7;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="dashboard-title">Gestionar Tareas</h1>
<p style="color: #86868b; margin-bottom: 2rem;">Panel de administraciÃ³n de tareas</p>

<div class="card">
    <h2 class="card-title">âž• Crear Nueva Tarea</h2>
    
    <div class="create-task-form">
        <form method="POST" action="{{ url_for('tasks.create_task') }}">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Nombre de la Tarea *</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="description">DescripciÃ³n</label>
                    <input type="text" id="description" name="description">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-success" style="width: 100%; height: 42px;">
                        Crear Tarea
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <h2 class="card-title">ðŸ“‹ Tareas Existentes</h2>
    
    {% if tasks %}
    <ul class="tasks-list">
        {% for task in tasks %}
        <li class="task-list-item {% if not task.is_active %}task-inactive{% endif %}">
            <div class="task-info">
                <h4>{{ task.name }}</h4>
                {% if task.description %}
                <p>{{ task.description }}</p>
                {% endif %}
                <p style="font-size: 0.85rem;">
                    <strong>Estado:</strong> 
                    {% if task.is_active %}
                    <span class="badge badge-success">Activa</span>
                    {% else %}
                    <span class="badge badge-secondary">Inactiva</span>
                    {% endif %}
                    &nbsp;|&nbsp;
                    <strong>Usos:</strong> {{ task.assignments.count() }}
                </p>
            </div>
            
            <div class="task-actions">
                <form method="POST" action="{{ url_for('tasks.toggle_task', task_id=task.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-secondary">
                        {% if task.is_active %}
                        Desactivar
                        {% else %}
                        Activar
                        {% endif %}
                    </button>
                </form>
                
                {% if task.assignments.count() == 0 %}
                <form method="POST" action="{{ url_for('tasks.delete_task', task_id=task.id) }}" 
                      onsubmit="return confirm('Â¿EstÃ¡s seguro de eliminar esta tarea?');" 
                      style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        Eliminar
                    </button>
                </form>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p style="text-align: center; padding: 2rem; color: #86868b;">
        No hay tareas creadas todavÃ­a
    </p>
    {% endif %}
</div>
{% endblock %}